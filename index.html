<!doctype html>
<html>
   <head>
      <title>Scour</title>
      <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
      <style>
	  body { background: #ebebeb; }
	  .container { background: #fff; }
      .error {
         color: #ff0000;
		 padding: 5px 0;
      }
	  #searchResults {
		padding: 10px 0;
		margin: 10px 0;
		border-top: solid 4px #ddd;
	  }

      ul.matches
      {
          list-style-type: none;
          width: 100%;
		  padding: 0;
      }
	  ul.matches li.influencer { 
		  overflow: hidden;
		  width: 30%;
		  display: inline-block;
		  margin-bottom: 16px;
	  }
	  .influencer ul {
		padding: 0;
		list-style: none;
	  }

      .influencer-thumb {
         display: inline-block;
         float: left;
         width: 50%;
         box-sizing: border-box;
      }

      .influencer-details {
         display: inline-block;
         float: left;
         margin-bottom: 16px;
         /*margin-left: 8px;*/
         width: 50%;
         box-sizing: border-box;
      }

      .influencer-detail-big {
         line-height: 1.11111111111;
         font-size: 1.125em;
         color: #f74902;
         font-weight: 700;
      }
      .influencer-match {
         margin-bottom: 16px;
         min-height: 80px;
		overflow: hidden;
		padding: 10px;
      }
	  #query {
	    padding: 6px;
		border-radius: 2px;
		border: 1px solid #ccc;
	  }
      </style>
   </head>
   <body>
      <div class="container">
		<div class="header">
			<h1>Scour Influencers!</h1>
			 <div id="errorMessage" class="error"></div>
			 <div id="searchForm">
				<input type="text" name="query" id="query" />&nbsp;<button type="submit" class="btn btn-primary">Scour!</button>
			 </div>
		</div>
         <div id="searchResults">
               
         </div>
      </div>

      <!-- Handlebars Template -->
      <script type="text/handlebars-template" class="matches-template">
         <ul class="matches">
         {{#each influencers}}
            <li class="influencer">
               <div class="influencer-match">
                  <div class="influencer-thumb">
                     {{#if avatar.medium}}
                        <img width="128" height="128" src="{{avatar.medium}}" />
                     {{else}}
                        <img width="128" height="128" src="http://blogs.villagevoice.com/runninscared/hogan.jpg" />
                     {{/if}}
                  </div>
                  <div class="influencer-details">
                     <div class="influencer-detail-big">
                        {{name}}
                     </div>
                     <div class="influencer-detail-small">
						<ul>
							{{#if location}}<li><strong>{{location}}</strong></li>{{/if}}
							<li>Reach: {{reach}}</li>
							<li>Resonance: {{resonance}}</li>
						</ul>
                     </div>
                  </div>
               </div>
            </li>
         {{/each}}
         </ul>
      </script>
      <!-- End Handlebars Template -->  
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.2/handlebars.min.js"></script>

      <script>
         $(document).ready(function() {
            var match_template  = Handlebars.compile($('.matches-template').html()),
            ERROR_MESSAGE = $("#errorMessage");

            ERROR_MESSAGE.hide();

            var showError = function(errorMsg) {
               ERROR_MESSAGE.show();
               ERROR_MESSAGE.text(errorMsg);
            }

            var validate = function() {
               if (window.location.hash && window.location.hash.length) {
                  ERROR_MESSAGE.hide();
                  return true;
               } else {
                  showError("An API key is required to search");
               }
            }

            var getSearchResults = function () {
               if (validate()) {
                  var query = $('#query').val();
                  var key = window.location.hash.substr(1);
                  $("#searchResults").html('');
				  $.ajax({
					type: "GET",
					url: "http://api-qa.traackr.com/1.0/influencers/lookup?api_key=" + key + "&all_filter=" + encodeURIComponent(query),
					success: function(data) {
						 var output = match_template(data);
						 $('#searchResults').html(output);
					},
					error: function(jqXHR, textStatus, errorThrown) {
						showError(errorThrown);
					}
				  });
                  /*$.getJSON('influencers.json?query=' + encodeURIComponent(query), function(data) {
                  
                     var output = match_template(data);
                     $('#searchResults').html(output);
                  });*/
               }
            }

            $('.btn-primary').click(function() {
               getSearchResults();
            });
         });
      </script>    
   </body>
</html>
