<html>
   <head>
      <title>Scour</title>
      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
      <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.2/handlebars.min.js"></script>
      <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
      <style>
      .error {
         color: #ff0000;
      }

      ul.matches
      {
          list-style-type: none;
          width: 100%;
      }

      .influencer {
         margin-bottom: 16px;
      }

      .influencer-thumb {
         display: inline-block;
         float: left;
         width: 25%;
         box-sizing: border-box;
      }

      .influencer-details {
         display: inline-block;
         float: left;
         margin-bottom: 16px;
         /*margin-left: 8px;*/
         width: 75%;
         box-sizing: border-box;
      }

      .influencer-detail-big {
         line-height: 1.11111111111;
         font-size: 1.125em;
         color: #f74902;
         font-weight: 700;
      }
      .influencer-match {
         margin-bottom: 16px;
         min-height: 80px;
      }
      </style>
      <script>
         $(document).ready(function() {
            var match_template  = Handlebars.compile($('.matches-template').html()),
            ERROR_MESSAGE = $("#errorMessage")

            ERROR_MESSAGE.hide();

            var showError = function(errorMsg) {
               ERROR_MESSAGE.show();
               ERROR_MESSAGE.text(errorMsg);
            }

            var validate = function() {
               if (window.location.hash && window.location.hash.length) {
                  ERROR_MESSAGE.hide();
                  return true;
               } else {
                  showError("Need a valid key")
               }
            }

            var getSearchResults = function () {
               if (validate()) {
                  var query = $('#query').val();
                  var key = window.location.hash.substr(1)

                  $("#searchResults").html('');

                  // $.getJSON('influencers.json?query=' + encodeURIComponent(query), function(data) {
                  $.getJSON('http://api.traackr.com/1.0/influencers/lookup?is_tag_prefix=false&name=' + encodeURIComponent(query) + '&gender=all&count=25&page=0&sort=name&sort_order=asc&api_key=' + key, function(data) {
                   //  var $el = $('#searchResults');
                   //  var listView = new infinity.ListView($el);

                     var output = match_template(data);
                     $('#searchResults').html(output);
                  });
               }
            }

            $('.btn-primary').click(function() {
               getSearchResults();
            });

            $('#query').keyup(function() {
               getSearchResults();
            });

         });
      </script>
   </head>
   <body>
      <div class="container">
        <img src="cyborg.jpg"/>
        <h1>Scour Influencers!</h1>
         <div id="errorMessage" class="error"></div>
         <div id="searchForm">
            <input type="text" name="query" id="query" />&nbsp;<button type="submit" class="btn btn-primary">Scour!</button>
         </div>
         <div id="searchResults">
               Results Will Go Here
         </div>
      </div>

      <script type="text/handlebars-template" class="matches-template">
         <ul class="matches">
         {{#each influencers}}
            <li class="influencer">
               <div class="influencer-match">
                  <div class="influencer-thumb">
                     {{#if avatar.medium}}
                        <img width="128" height="128" src="{{avatar.medium}}" />
                     {{else}}
                        <img width="128" height="128" src="http://blogs.villagevoice.com/runninscared/hogan.jpg" />
                     {{/if}}
                  </div>
                  <div class="influencer-details">
                     <div class="influencer-detail-big">
                        {{name}}
                     </div>
                     <div class="influencer-detail-small">
                        {{#if location}}<strong>{{location}}</strong><br />{{/if}}
                        {{description}}
                     </div>
                  </div>
               </div>
            </li>
            <div style="clear:both"></div>
         {{/each}}
         </ul>
      </script>
   </body>
</html>
